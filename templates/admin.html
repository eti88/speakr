<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Admin Dashboard - Speakr</title>
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script>
        // Function to apply the theme based on localStorage
        function applyTheme() {
            // Apply dark mode
            const savedMode = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedMode === 'true' || (savedMode === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }

            // Apply color scheme
            const savedScheme = localStorage.getItem('colorScheme') || 'blue';
            const isDark = document.documentElement.classList.contains('dark');
            const themePrefix = isDark ? 'theme-dark-' : 'theme-light-';
            
            // Remove all other theme classes
            const themeClasses = ['blue', 'emerald', 'purple', 'rose', 'amber', 'teal'];
            themeClasses.forEach(theme => {
                document.documentElement.classList.remove(`theme-light-${theme}`);
                document.documentElement.classList.remove(`theme-dark-${theme}`);
            });

            // Add the correct theme class
            if (savedScheme !== 'blue') {
                 document.documentElement.classList.add(themePrefix + savedScheme);
            }
        }
        applyTheme();
    </script>
</head>
<body class="bg-[var(--bg-primary)] text-[var(--text-primary)]">
    <div id="app" class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 flex flex-col min-h-screen">
        <header class="flex justify-between items-center mb-6 pb-4 border-b border-[var(--border-primary)]">
            <h1 class="text-3xl font-bold text-[var(--text-primary)]">
                <a href="{{ url_for('index') }}" class="flex items-center">
                    <img src="{{ url_for('static', filename='img/icon-192x192.png') }}" alt="Speakr Logo" class="h-9 w-9 mr-2">
                    Speakr
                </a>
            </h1>
            <div class="flex items-center space-x-2">
                <button @click="toggleDarkMode" class="p-2 rounded-full text-[var(--text-muted)] hover:bg-[var(--bg-tertiary)] dark:text-gray-400 dark:hover:bg-gray-700 transition-colors duration-200" :title="isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
                    <i :class="isDarkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
                </button>
                <div class="relative">
                    <button @click="isUserMenuOpen = !isUserMenuOpen" class="flex items-center px-3 py-2 border border-[var(--border-secondary)] rounded-lg text-[var(--text-secondary)] hover:text-[var(--text-accent)] focus:outline-none">
                        <i class="fas fa-user-shield mr-2"></i>
                        <span>{{ current_user.username }}</span>
                        <i class="fas fa-chevron-down ml-2"></i>
                    </button>
                    <div v-if="isUserMenuOpen" class="absolute right-0 mt-2 w-48 bg-[var(--bg-secondary)] border border-[var(--border-primary)] rounded-lg shadow-lg z-10">
                        <a href="{{ url_for('index') }}" class="block px-4 py-2 text-[var(--text-secondary)] hover:bg-[var(--bg-tertiary)] hover:text-[var(--text-accent)]">
                            <i class="fas fa-home mr-2"></i> Home
                        </a>
                        <a href="{{ url_for('account') }}" class="block px-4 py-2 text-[var(--text-secondary)] hover:bg-[var(--bg-tertiary)] hover:text-[var(--text-accent)]">
                            <i class="fas fa-user mr-2"></i> Account
                        </a>
                        <a href="{{ url_for('admin') }}" class="block px-4 py-2 text-[var(--text-accent)] bg-[var(--bg-accent)]">
                            <i class="fas fa-user-shield mr-2"></i> Admin
                        </a>
                        <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-[var(--text-secondary)] hover:bg-[var(--bg-tertiary)] hover:text-[var(--text-danger)]">
                            <i class="fas fa-sign-out-alt mr-2"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-grow">
            <div class="bg-[var(--bg-secondary)] p-4 sm:p-6 lg:p-8 rounded-xl shadow-lg border border-[var(--border-primary)]">
                <h2 class="text-2xl font-semibold text-[var(--text-primary)] mb-6">Admin Dashboard</h2>
                
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="mb-4 p-3 rounded-lg {% if category == 'success' %}bg-[var(--bg-success-light)] text-[var(--text-success-strong)]{% elif category == 'danger' %}bg-[var(--bg-danger-light)] text-[var(--text-danger-strong)]{% else %}bg-[var(--bg-info-light)] text-[var(--text-info-strong)]{% endif %}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <!-- Tabs -->
                <div class="border-b border-[var(--border-primary)] mb-6 sm:border-b">
                    <nav class="tab-nav -mb-px flex flex-col sm:flex-row sm:space-x-8" aria-label="Tabs">
                        <button @click="activeTab = 'users'" 
                                :class="activeTab === 'users' ? 'border-[var(--border-focus)] text-[var(--text-accent)] bg-[var(--bg-tertiary)] sm:bg-transparent' : 'border-transparent text-[var(--text-muted)] hover:text-[var(--text-secondary)] hover:border-[var(--border-secondary)] hover:bg-[var(--bg-tertiary)] sm:hover:bg-transparent'"
                                class="flex items-center whitespace-nowrap py-3 sm:py-4 px-3 sm:px-1 border-b sm:border-b-2 border-l-4 sm:border-l-0 font-medium text-sm">
                            <i class="fas fa-users mr-2"></i><span>User Management</span>
                        </button>
                        <button @click="activeTab = 'stats'" 
                                :class="activeTab === 'stats' ? 'border-[var(--border-focus)] text-[var(--text-accent)] bg-[var(--bg-tertiary)] sm:bg-transparent' : 'border-transparent text-[var(--text-muted)] hover:text-[var(--text-secondary)] hover:border-[var(--border-secondary)] hover:bg-[var(--bg-tertiary)] sm:hover:bg-transparent'"
                                class="flex items-center whitespace-nowrap py-3 sm:py-4 px-3 sm:px-1 border-b sm:border-b-2 border-l-4 sm:border-l-0 font-medium text-sm">
                            <i class="fas fa-chart-bar mr-2"></i><span>System Statistics</span>
                        </button>
                        <button @click="activeTab = 'settings'" 
                                :class="activeTab === 'settings' ? 'border-[var(--border-focus)] text-[var(--text-accent)] bg-[var(--bg-tertiary)] sm:bg-transparent' : 'border-transparent text-[var(--text-muted)] hover:text-[var(--text-secondary)] hover:border-[var(--border-secondary)] hover:bg-[var(--bg-tertiary)] sm:hover:bg-transparent'"
                                class="flex items-center whitespace-nowrap py-3 sm:py-4 px-3 sm:px-1 border-b sm:border-b-2 border-l-4 sm:border-l-0 font-medium text-sm">
                            <i class="fas fa-cogs mr-2"></i><span>System Settings</span>
                        </button>
                        <button @click="activeTab = 'prompts'" 
                                :class="activeTab === 'prompts' ? 'border-[var(--border-focus)] text-[var(--text-accent)] bg-[var(--bg-tertiary)] sm:bg-transparent' : 'border-transparent text-[var(--text-muted)] hover:text-[var(--text-secondary)] hover:border-[var(--border-secondary)] hover:bg-[var(--bg-tertiary)] sm:hover:bg-transparent'"
                                class="flex items-center whitespace-nowrap py-3 sm:py-4 px-3 sm:px-1 border-b sm:border-b-2 border-l-4 sm:border-l-0 font-medium text-sm">
                            <i class="fas fa-file-alt mr-2"></i><span>Default Prompts</span>
                        </button>
                        <button @click="activeTab = 'vectorstore'" 
                                :class="activeTab === 'vectorstore' ? 'border-[var(--border-focus)] text-[var(--text-accent)] bg-[var(--bg-tertiary)] sm:bg-transparent' : 'border-transparent text-[var(--text-muted)] hover:text-[var(--text-secondary)] hover:border-[var(--border-secondary)] hover:bg-[var(--bg-tertiary)] sm:hover:bg-transparent'"
                                class="flex items-center whitespace-nowrap py-3 sm:py-4 px-3 sm:px-1 border-b sm:border-b-2 border-l-4 sm:border-l-0 font-medium text-sm"
                                v-if="inquireModeEnabled">
                            <i class="fas fa-database mr-2"></i><span>Vector Store</span>
                        </button>
                    </nav>
                </div>
                
                <!-- User Management Tab -->
                <div v-show="activeTab === 'users'">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-[var(--text-secondary)]">User Management</h3>
                        <button @click="showAddUserModal = true" class="px-4 py-2 bg-[var(--bg-button)] text-[var(--text-button)] rounded-lg shadow hover:bg-[var(--bg-button-hover)] focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] focus:ring-offset-2 transition duration-150 ease-in-out">
                            <i class="fas fa-user-plus mr-2"></i> Add User
                        </button>
                    </div>
                    
                    <!-- Search and Filter -->
                    <div class="mb-4 flex">
                        <div class="relative flex-grow">
                            <input type="text" v-model="userSearchQuery" placeholder="Search users..." class="w-full px-4 py-2 border border-[var(--border-secondary)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]">
                            <button v-if="userSearchQuery" @click="userSearchQuery = ''" class="absolute right-3 top-2.5 text-[var(--text-muted)] hover:text-[var(--text-secondary)]">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Users Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-[var(--border-primary)]">
                            <thead class="bg-[var(--bg-tertiary)]">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[var(--text-muted)] uppercase tracking-wider">ID</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[var(--text-muted)] uppercase tracking-wider">Username</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[var(--text-muted)] uppercase tracking-wider">Email</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[var(--text-muted)] uppercase tracking-wider">Admin</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[var(--text-muted)] uppercase tracking-wider">Recordings</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[var(--text-muted)] uppercase tracking-wider">Storage Used</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-[var(--text-muted)] uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-[var(--bg-secondary)] divide-y divide-[var(--border-primary)]">
                                <tr v-for="user in filteredUsers" :key="user.id" class="hover:bg-[var(--bg-tertiary)]">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[var(--text-secondary)]">${ user.id }</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-[var(--text-primary)]">${ user.username }</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[var(--text-secondary)]">${ user.email }</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[var(--text-secondary)]">
                                        <span v-if="user.is_admin" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-[var(--bg-success-light)] text-[var(--text-success-strong)]">Yes</span>
                                        <span v-else class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-[var(--bg-pending-light)] text-[var(--text-pending-strong)]">No</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[var(--text-secondary)]">${ user.recordings_count }</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[var(--text-secondary)]">${ formatFileSize(user.storage_used) }</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[var(--text-secondary)]">
                                        <div class="flex space-x-2">
                                            <button @click="editUser(user)" class="text-[var(--text-accent)] hover:text-[var(--text-accent-hover)]" title="Edit User">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button @click="toggleAdminStatus(user)" :class="user.is_admin ? 'text-[var(--text-warn-strong)]' : 'text-[var(--text-info-strong)]'" :title="user.is_admin ? 'Remove Admin' : 'Make Admin'">
                                                <i class="fas" :class="user.is_admin ? 'fa-user-minus' : 'fa-user-shield'"></i>
                                            </button>
                                            <button @click="confirmDeleteUser(user)" class="text-[var(--text-danger)] hover:text-[var(--text-danger-hover)]" title="Delete User">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr v-if="filteredUsers.length === 0">
                                    <td colspan="7" class="px-6 py-4 text-center text-sm text-[var(--text-muted)]">
                                        <div v-if="isLoadingUsers">
                                            <i class="fas fa-spinner fa-spin mr-2"></i> Loading users...
                                        </div>
                                        <div v-else>
                                            No users found.
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- System Statistics Tab -->
                <div v-show="activeTab === 'stats'">
                    <h3 class="text-lg font-medium text-[var(--text-secondary)] mb-4">System Statistics</h3>
                    
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-[var(--bg-tertiary)] p-4 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-[var(--bg-info-light)] text-[var(--text-info-strong)]">
                                    <i class="fas fa-users text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-[var(--text-muted)]">Total Users</p>
                                    <p class="text-2xl font-semibold text-[var(--text-primary)]">${ stats.total_users }</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-[var(--bg-tertiary)] p-4 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-[var(--bg-success-light)] text-[var(--text-success-strong)]">
                                    <i class="fas fa-file-audio text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-[var(--text-muted)]">Total Recordings</p>
                                    <p class="text-2xl font-semibold text-[var(--text-primary)]">${ stats.total_recordings }</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-[var(--bg-tertiary)] p-4 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-[var(--bg-warn-light)] text-[var(--text-warn-strong)]">
                                    <i class="fas fa-database text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-[var(--text-muted)]">Total Storage Used</p>
                                    <p class="text-2xl font-semibold text-[var(--text-primary)]">${ formatFileSize(stats.total_storage) }</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-[var(--bg-tertiary)] p-4 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-[var(--bg-accent)] text-[var(--text-accent)]">
                                    <i class="fas fa-comments text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-[var(--text-muted)]">Total Queries</p>
                                    <p class="text-2xl font-semibold text-[var(--text-primary)]">${ stats.total_queries }</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Status Distribution -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-[var(--bg-tertiary)] p-4 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <h4 class="text-md font-medium text-[var(--text-secondary)] mb-3">Recording Status Distribution</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center p-3 bg-[var(--bg-secondary)] rounded-lg border border-[var(--border-primary)] shadow-sm">
                                    <span class="block text-2xl font-bold text-[var(--text-success-strong)]">${ stats.completed_recordings }</span>
                                    <span class="block text-sm text-[var(--text-muted)]">Completed</span>
                                </div>
                                <div class="text-center p-3 bg-[var(--bg-secondary)] rounded-lg border border-[var(--border-primary)] shadow-sm">
                                    <span class="block text-2xl font-bold text-[var(--text-warn-strong)]">${ stats.processing_recordings }</span>
                                    <span class="block text-sm text-[var(--text-muted)]">Processing</span>
                                </div>
                                <div class="text-center p-3 bg-[var(--bg-secondary)] rounded-lg border border-[var(--border-primary)] shadow-sm">
                                    <span class="block text-2xl font-bold text-[var(--text-pending-strong)]">${ stats.pending_recordings }</span>
                                    <span class="block text-sm text-[var(--text-muted)]">Pending</span>
                                </div>
                                <div class="text-center p-3 bg-[var(--bg-secondary)] rounded-lg border border-[var(--border-primary)] shadow-sm">
                                    <span class="block text-2xl font-bold text-[var(--text-danger-strong)]">${ stats.failed_recordings }</span>
                                    <span class="block text-sm text-[var(--text-muted)]">Failed</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-[var(--bg-tertiary)] p-4 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <h4 class="text-md font-medium text-[var(--text-secondary)] mb-3">Top Users by Storage</h4>
                            <div class="space-y-3">
                                <div v-for="user in stats.top_users" :key="user.id" class="flex justify-between items-center p-2 bg-[var(--bg-secondary)] rounded-lg border border-[var(--border-primary)]">
                                    <div class="flex items-center">
                                        <i class="fas fa-user text-[var(--text-accent)] mr-2"></i>
                                        <span class="text-sm font-medium text-[var(--text-primary)]">${ user.username }</span>
                                    </div>
                                    <div class="text-sm text-[var(--text-secondary)]">
                                        <span class="font-medium">${ formatFileSize(user.storage_used) }</span>
                                        <span class="text-[var(--text-muted)] ml-2">(${ user.recordings_count} recordings)</span>
                                    </div>
                                </div>
                                <div v-if="stats.top_users.length === 0" class="text-center text-sm text-[var(--text-muted)] p-2">
                                    No data available
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Settings Tab -->
                <div v-show="activeTab === 'settings'">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-[var(--text-secondary)]">System Settings</h3>
                        <button @click="loadSettings" class="px-4 py-2 bg-[var(--bg-button)] text-[var(--text-button)] rounded-lg shadow hover:bg-[var(--bg-button-hover)] focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] focus:ring-offset-2 transition duration-150 ease-in-out">
                            <i class="fas fa-sync-alt mr-2"></i> Refresh
                        </button>
                    </div>
                    
                    <!-- Settings List -->
                    <div class="space-y-4">
                        <div v-for="setting in settings" :key="setting.id" class="bg-[var(--bg-tertiary)] p-4 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex justify-between items-start">
                                <div class="flex-grow">
                                    <h4 class="text-md font-medium text-[var(--text-primary)] mb-1">${ setting.key }</h4>
                                    <p class="text-sm text-[var(--text-muted)] mb-2">${ setting.description || 'No description available' }</p>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-xs px-2 py-1 bg-[var(--bg-accent)] text-[var(--text-accent)] rounded">${ setting.setting_type }</span>
                                        <span class="text-xs text-[var(--text-muted)]">Last updated: ${ formatDate(setting.updated_at) }</span>
                                    </div>
                                </div>
                                <div class="ml-4 flex items-center space-x-2">
                                    <div class="text-right">
                                        <div class="text-sm font-medium text-[var(--text-primary)]">
                                            <span v-if="setting.setting_type === 'boolean'">
                                                <span v-if="setting.value === 'true'" class="text-[var(--text-success-strong)]">
                                                    <i class="fas fa-check-circle mr-1"></i> Enabled
                                                </span>
                                                <span v-else class="text-[var(--text-danger-strong)]">
                                                    <i class="fas fa-times-circle mr-1"></i> Disabled
                                                </span>
                                            </span>
                                            <span v-else-if="setting.key === 'transcript_length_limit' && setting.value === '-1'" class="text-[var(--text-info-strong)]">
                                                <i class="fas fa-infinity mr-1"></i> No Limit
                                            </span>
                            <span v-else-if="setting.key === 'transcript_length_limit'" class="text-[var(--text-primary)]">
                                ${ Number(setting.value).toLocaleString() } characters
                            </span>
                            <span v-else-if="setting.key === 'max_file_size_mb'" class="text-[var(--text-primary)]">
                                ${ Number(setting.value).toLocaleString() } MB
                            </span>
                            <span v-else-if="setting.key === 'asr_timeout_seconds'" class="text-[var(--text-primary)]">
                                ${ Number(setting.value).toLocaleString() } seconds
                            </span>
                                            <span v-else>${ setting.value || 'Not set' }</span>
                                        </div>
                                    </div>
                                    <button @click="editSetting(setting)" class="text-[var(--text-accent)] hover:text-[var(--text-accent-hover)] p-1" title="Edit Setting">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div v-if="settings.length === 0" class="text-center py-8">
                            <div v-if="isLoadingSettings">
                                <i class="fas fa-spinner fa-spin mr-2"></i> Loading settings...
                            </div>
                            <div v-else class="text-[var(--text-muted)]">
                                No system settings found.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Default Prompts Tab -->
                <div v-show="activeTab === 'prompts'">
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-[var(--text-secondary)] mb-4">Default Prompts</h3>
                        <div class="bg-[var(--bg-info-light)] text-[var(--text-info-strong)] p-4 rounded-lg mb-4">
                            <i class="fas fa-info-circle mr-2"></i>
                            This default prompt will be used for all users who haven't set their own custom prompt in their account settings.
                        </div>
                    </div>
                    
                    <div class="bg-[var(--bg-tertiary)] p-6 rounded-lg border border-[var(--border-primary)]">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2">
                                Default Summarization Prompt
                            </label>
                            <p class="text-sm text-[var(--text-muted)] mb-3">
                                This prompt will be used to generate summaries for all recordings when users haven't set their own prompt.
                            </p>
                            <textarea 
                                v-model="defaultSummaryPrompt"
                                rows="8"
                                class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]"
                                placeholder="Enter the default summarization prompt...">
                            </textarea>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <button @click="resetDefaultPrompt" 
                                        class="px-4 py-2 border border-[var(--border-secondary)] text-[var(--text-secondary)] rounded-md hover:bg-[var(--bg-tertiary)]">
                                    <i class="fas fa-undo mr-2"></i> Reset to Default
                                </button>
                            </div>
                            <div>
                                <button @click="saveDefaultPrompt" 
                                        :disabled="isSavingPrompt"
                                        class="px-4 py-2 bg-[var(--bg-button)] text-[var(--text-button)] rounded-md hover:bg-[var(--bg-button-hover)] disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i v-if="isSavingPrompt" class="fas fa-spinner fa-spin mr-2"></i>
                                    <i v-else class="fas fa-save mr-2"></i>
                                    ${ isSavingPrompt ? 'Saving...' : 'Save Changes' }
                                </button>
                            </div>
                        </div>
                        
                        <div v-if="promptSaveMessage" class="mt-4">
                            <div :class="promptSaveError ? 'bg-[var(--bg-danger-light)] text-[var(--text-danger-strong)]' : 'bg-[var(--bg-success-light)] text-[var(--text-success-strong)]'" 
                                 class="p-3 rounded-md text-sm">
                                ${ promptSaveMessage }
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-[var(--bg-tertiary)] p-6 rounded-lg border border-[var(--border-primary)]">
                        <h4 class="text-md font-medium text-[var(--text-secondary)] mb-3">Prompt Hierarchy</h4>
                        <p class="text-sm text-[var(--text-muted)] mb-3">
                            The system uses the following priority order when selecting which prompt to use:
                        </p>
                        <ol class="list-decimal list-inside space-y-2 text-sm text-[var(--text-secondary)]">
                            <li><strong>Tag Custom Prompt:</strong> If a recording has tags with custom prompts</li>
                            <li><strong>User Custom Prompt:</strong> If the user has set their own prompt in account settings</li>
                            <li><strong>Admin Default Prompt:</strong> The prompt configured above (shown on this page)</li>
                            <li><strong>System Fallback:</strong> A hardcoded default if none of the above are set</li>
                        </ol>
                    </div>
                    
                    <!-- Full LLM Prompt Structure Expander -->
                    <div class="mt-6 bg-[var(--bg-tertiary)] rounded-lg border border-[var(--border-primary)]">
                        <button @click="showFullPromptStructure = !showFullPromptStructure" 
                                class="w-full p-6 flex justify-between items-center hover:bg-[var(--bg-quaternary)] transition-colors duration-200">
                            <h4 class="text-md font-medium text-[var(--text-secondary)]">
                                <i class="fas fa-code mr-2"></i>
                                View Full LLM Prompt Structure
                            </h4>
                            <i :class="showFullPromptStructure ? 'fas fa-chevron-up' : 'fas fa-chevron-down'" 
                               class="text-[var(--text-muted)]"></i>
                        </button>
                        
                        <div v-show="showFullPromptStructure" class="border-t border-[var(--border-primary)]">
                            <div class="p-6 space-y-6">
                                <div>
                                    <h5 class="text-sm font-semibold text-[var(--text-accent)] mb-2">System Prompt:</h5>
                                    <div class="bg-[var(--bg-secondary)] p-4 rounded-md border border-[var(--border-secondary)]">
                                        <pre class="text-xs text-[var(--text-secondary)] whitespace-pre-wrap font-mono">You are an AI assistant that generates comprehensive summaries for meeting transcripts. Respond only with the summary in Markdown format. Do NOT use markdown code blocks (```markdown). Provide raw markdown content directly.<span v-if="defaultSummaryPrompt || originalDefaultPrompt">

Summarization Instructions:
${ defaultSummaryPrompt || originalDefaultPrompt }</span></pre>
                                    </div>
                                    <p class="text-xs text-[var(--text-muted)] mt-2">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        Note: If the user has set an output language preference, " Ensure your response is in {language}." will be added.
                                    </p>
                                </div>
                                
                                <div>
                                    <h5 class="text-sm font-semibold text-[var(--text-accent)] mb-2">User Message Template:</h5>
                                    <div class="bg-[var(--bg-secondary)] p-4 rounded-md border border-[var(--border-secondary)]">
                                        <pre class="text-xs text-[var(--text-secondary)] whitespace-pre-wrap font-mono">Context:
- Current date: {current_date}
- Tags applied to this transcript by the user: {tag_names} <span class="text-[var(--text-muted)]">(if tags exist)</span>
- Information about the user: Name: {name}, Job title: {job_title}, Company: {company} <span class="text-[var(--text-muted)]">(if provided)</span>

Transcription:
"""
{transcript_text}
"""

Please analyze the above transcription and generate a summary following the provided instructions.</pre>
                                    </div>
                                    <p class="text-xs text-[var(--text-muted)] mt-2">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        Placeholders are replaced with actual values when processing a recording.
                                    </p>
                                </div>
                                
                                <div>
                                    <h5 class="text-sm font-semibold text-[var(--text-accent)] mb-2">Additional Context:</h5>
                                    <div class="bg-[var(--bg-info-light)] p-4 rounded-md">
                                        <ul class="text-xs text-[var(--text-info-strong)] space-y-2">
                                            <li><i class="fas fa-check-circle mr-1"></i> Transcripts are limited to a configurable character count (default: 30,000)</li>
                                            <li><i class="fas fa-check-circle mr-1"></i> JSON transcripts are converted to clean text format before sending</li>
                                            <li><i class="fas fa-check-circle mr-1"></i> If multiple tag prompts exist, they are merged in the order tags were added</li>
                                            <li><i class="fas fa-check-circle mr-1"></i> The model used is configured via TEXT_MODEL_NAME environment variable</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Vector Store Tab -->
                <div v-show="activeTab === 'vectorstore'" v-if="inquireModeEnabled">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-medium text-[var(--text-secondary)]">Vector Store Management</h3>
                        <button @click="loadInquireStatus" class="px-4 py-2 bg-[var(--bg-button)] text-[var(--text-button)] rounded-lg shadow hover:bg-[var(--bg-button-hover)] focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] focus:ring-offset-2 transition duration-150 ease-in-out">
                            <i class="fas fa-sync-alt mr-2"></i> Refresh Status
                        </button>
                    </div>
                    
                    <!-- Vector Store Info -->
                    <div class="bg-[var(--bg-tertiary)] p-6 rounded-lg border border-[var(--border-primary)] mb-6">
                        <h4 class="text-md font-semibold text-[var(--text-primary)] mb-4">
                            <i class="fas fa-info-circle mr-2"></i>About Inquire Mode
                        </h4>
                        <p class="text-sm text-[var(--text-secondary)] mb-3">
                            Inquire Mode allows users to search across multiple transcriptions using natural language questions. 
                            It works by breaking transcriptions into chunks and creating searchable embeddings using AI models.
                        </p>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-[var(--text-muted)]">Chunk Size:</span>
                                <span class="ml-2 text-[var(--text-primary)]">500 characters</span>
                            </div>
                            <div>
                                <span class="text-[var(--text-muted)]">Overlap:</span>
                                <span class="ml-2 text-[var(--text-primary)]">50 characters</span>
                            </div>
                            <div>
                                <span class="text-[var(--text-muted)]">Embedding Model:</span>
                                <span class="ml-2 text-[var(--text-primary)]">all-MiniLM-L6-v2</span>
                            </div>
                            <div>
                                <span class="text-[var(--text-muted)]">Vector Dimensions:</span>
                                <span class="ml-2 text-[var(--text-primary)]">384</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Statistics Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                        <div class="bg-[var(--bg-secondary)] p-6 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-[var(--text-muted)]">Total Recordings</p>
                                    <p class="text-2xl font-semibold text-[var(--text-primary)]">${ inquireStatus.total_completed_recordings || 0 }</p>
                                </div>
                                <i class="fas fa-file-audio text-3xl text-[var(--text-accent)] opacity-50"></i>
                            </div>
                        </div>
                        
                        <div class="bg-[var(--bg-secondary)] p-6 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-[var(--text-muted)]">Processed for Inquire</p>
                                    <p class="text-2xl font-semibold text-[var(--text-success-strong)]">${ inquireStatus.processed_for_inquire || 0 }</p>
                                </div>
                                <i class="fas fa-check-circle text-3xl text-[var(--text-success-strong)] opacity-50"></i>
                            </div>
                        </div>
                        
                        <div class="bg-[var(--bg-secondary)] p-6 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-[var(--text-muted)]">Need Processing</p>
                                    <p class="text-2xl font-semibold" :class="inquireStatus.need_processing > 0 ? 'text-[var(--text-warning-strong)]' : 'text-[var(--text-primary)]'">
                                        ${ inquireStatus.need_processing || 0 }
                                    </p>
                                </div>
                                <i class="fas fa-clock text-3xl opacity-50" :class="inquireStatus.need_processing > 0 ? 'text-[var(--text-warning-strong)]' : 'text-[var(--text-muted)]'"></i>
                            </div>
                        </div>
                        
                        <div class="bg-[var(--bg-secondary)] p-6 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-[var(--text-muted)]">Total Chunks</p>
                                    <p class="text-2xl font-semibold text-[var(--text-primary)]">${ inquireStatus.total_chunks || 0 }</p>
                                </div>
                                <i class="fas fa-th text-3xl text-[var(--text-accent)] opacity-50"></i>
                            </div>
                        </div>
                        
                        <div class="bg-[var(--bg-secondary)] p-6 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-[var(--text-muted)]">Embeddings Status</p>
                                    <p class="text-lg font-semibold" :class="inquireStatus.embeddings_available ? 'text-[var(--text-success-strong)]' : 'text-[var(--text-warning-strong)]'">
                                        <i :class="inquireStatus.embeddings_available ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle'" class="mr-2"></i>
                                        ${ inquireStatus.embeddings_available ? 'Available' : 'Text Search Only' }
                                    </p>
                                </div>
                                <i class="fas fa-brain text-3xl opacity-50" :class="inquireStatus.embeddings_available ? 'text-[var(--text-success-strong)]' : 'text-[var(--text-warning-strong)]'"></i>
                            </div>
                        </div>
                        
                        <div class="bg-[var(--bg-secondary)] p-6 rounded-lg border border-[var(--border-primary)] shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-[var(--text-muted)]">Processing Progress</p>
                                    <div class="mt-2">
                                        <div class="w-full bg-[var(--bg-tertiary)] rounded-full h-2.5">
                                            <div class="bg-[var(--text-accent)] h-2.5 rounded-full" :style="{width: getProcessingProgress() + '%'}"></div>
                                        </div>
                                        <p class="text-xs text-[var(--text-muted)] mt-1">${ getProcessingProgress() }% complete</p>
                                    </div>
                                </div>
                                <i class="fas fa-tasks text-3xl text-[var(--text-accent)] opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Processing Actions -->
                    <div class="bg-[var(--bg-tertiary)] p-6 rounded-lg border border-[var(--border-primary)]">
                        <h4 class="text-md font-semibold text-[var(--text-primary)] mb-4">
                            <i class="fas fa-cog mr-2"></i>Processing Actions
                        </h4>
                        
                        <div v-if="inquireStatus.need_processing > 0" class="mb-4">
                            <p class="text-sm text-[var(--text-secondary)] mb-4">
                                There are <span class="font-semibold text-[var(--text-warning-strong)]">${ inquireStatus.need_processing }</span> recordings that need to be processed for Inquire Mode.
                            </p>
                            
                            <div class="flex flex-wrap gap-3">
                                <button @click="processAllRecordings" 
                                        :disabled="isProcessingRecordings"
                                        class="px-4 py-2 bg-[var(--bg-button)] text-[var(--text-button)] rounded-lg shadow hover:bg-[var(--bg-button-hover)] focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] focus:ring-offset-2 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i :class="isProcessingRecordings ? 'fas fa-spinner fa-spin' : 'fas fa-play'" class="mr-2"></i>
                                    ${ isProcessingRecordings ? 'Processing...' : 'Process All Recordings' }
                                </button>
                                
                                <button @click="processBatchRecordings(10)" 
                                        :disabled="isProcessingRecordings"
                                        class="px-4 py-2 bg-[var(--bg-secondary)] text-[var(--text-secondary)] border border-[var(--border-secondary)] rounded-lg shadow hover:bg-[var(--bg-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] focus:ring-offset-2 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fas fa-forward mr-2"></i>
                                    Process Next 10
                                </button>
                            </div>
                            
                            <div v-if="processingResult" class="mt-4 p-4 rounded-lg" 
                                 :class="processingResult.success ? 'bg-[var(--bg-success-light)] text-[var(--text-success-strong)]' : 'bg-[var(--bg-danger-light)] text-[var(--text-danger-strong)]'">
                                <p class="font-medium">${ processingResult.message }</p>
                                <div v-if="processingResult.failed && processingResult.failed.length > 0" class="mt-2">
                                    <p class="text-sm font-medium">Failed recordings:</p>
                                    <ul class="text-xs mt-1 space-y-1">
                                        <li v-for="fail in processingResult.failed" :key="fail.id">
                                            ID ${ fail.id }: ${ fail.title } - ${ fail.reason }
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div v-else class="text-center py-4">
                            <i class="fas fa-check-circle text-4xl text-[var(--text-success-strong)] mb-3"></i>
                            <p class="text-[var(--text-success-strong)] font-medium">All recordings are processed!</p>
                            <p class="text-sm text-[var(--text-muted)] mt-1">The vector store is up to date.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="text-center py-4 mt-8 text-xs text-[var(--text-light)] border-t border-[var(--border-primary)]">
            Speakr &copy; {{ now.year }}
        </footer>
        
        <!-- Add User Modal -->
        <div v-if="showAddUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-xl w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-[var(--text-primary)]">Add New User</h3>
                    <button @click="showAddUserModal = false" class="text-[var(--text-muted)] hover:text-[var(--text-secondary)]">&times;</button>
                </div>
                <form @submit.prevent="addUser">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Username</label>
                        <input v-model="newUser.username" type="text" required class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Email</label>
                        <input v-model="newUser.email" type="email" required class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Password</label>
                        <input v-model="newUser.password" type="password" required class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Confirm Password</label>
                        <input v-model="newUser.confirmPassword" type="password" required class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]">
                    </div>
                    <div class="mb-4 flex items-center">
                        <input v-model="newUser.isAdmin" type="checkbox" id="isAdmin" class="rounded border-[var(--border-secondary)] text-[var(--text-accent)] focus:ring-[var(--border-focus)]">
                        <label for="isAdmin" class="ml-2 text-sm text-[var(--text-secondary)]">Admin User</label>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" @click="showAddUserModal = false" class="px-4 py-2 border border-[var(--border-secondary)] text-[var(--text-secondary)] rounded-md hover:bg-[var(--bg-tertiary)]">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-[var(--bg-button)] text-[var(--text-button)] rounded-md hover:bg-[var(--bg-button-hover)]">Add User</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Edit User Modal -->
        <div v-if="showEditUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-xl w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-[var(--text-primary)]">Edit User</h3>
                    <button @click="showEditUserModal = false" class="text-[var(--text-muted)] hover:text-[var(--text-secondary)]">&times;</button>
                </div>
                <form @submit.prevent="updateUser">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Username</label>
                        <input v-model="editingUser.username" type="text" required class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Email</label>
                        <input v-model="editingUser.email" type="email" required class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">New Password (leave blank to keep current)</label>
                        <input v-model="editingUser.password" type="password" class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]">
                    </div>
                    <div class="mb-4 flex items-center">
                        <input v-model="editingUser.is_admin" type="checkbox" id="editIsAdmin" class="rounded border-[var(--border-secondary)] text-[var(--text-accent)] focus:ring-[var(--border-focus)]">
                        <label for="editIsAdmin" class="ml-2 text-sm text-[var(--text-secondary)]">Admin User</label>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" @click="showEditUserModal = false" class="px-4 py-2 border border-[var(--border-secondary)] text-[var(--text-secondary)] rounded-md hover:bg-[var(--bg-tertiary)]">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-[var(--bg-button)] text-[var(--text-button)] rounded-md hover:bg-[var(--bg-button-hover)]">Update User</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Delete User Confirmation Modal -->
        <div v-if="showDeleteUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-xl w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-[var(--text-primary)]">Confirm Delete</h3>
                    <button @click="showDeleteUserModal = false" class="text-[var(--text-muted)] hover:text-[var(--text-secondary)]">&times;</button>
                </div>
                <p class="mb-4 text-[var(--text-secondary)]">Are you sure you want to delete the user <span class="font-semibold">${ userToDelete?.username }</span>? This action cannot be undone.</p>
                <div class="flex justify-end space-x-3">
                    <button @click="showDeleteUserModal = false" class="px-4 py-2 border border-[var(--border-secondary)] text-[var(--text-secondary)] rounded-md hover:bg-[var(--bg-tertiary)]">Cancel</button>
                    <button @click="deleteUser" class="px-4 py-2 bg-[var(--bg-danger)] text-[var(--text-button)] rounded-md hover:bg-[var(--bg-danger-hover)]">Delete User</button>
                </div>
            </div>
        </div>
        
        <!-- Edit System Setting Modal -->
        <div v-if="showEditSettingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-xl w-full max-w-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-[var(--text-primary)]">Edit System Setting</h3>
                    <button @click="showEditSettingModal = false" class="text-[var(--text-muted)] hover:text-[var(--text-secondary)] text-2xl leading-none">&times;</button>
                </div>
                
                <div v-if="editingSetting" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Setting Key</label>
                        <div class="px-3 py-2 bg-[var(--bg-tertiary)] text-[var(--text-muted)] rounded-md font-mono text-sm">
                            ${ editingSetting.key }
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Description</label>
                        <div class="px-3 py-2 text-[var(--text-muted)] text-sm">
                            ${ editingSetting.description || 'No description available' }
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Type</label>
                        <span class="inline-block px-2 py-1 bg-[var(--bg-accent)] text-[var(--text-accent)] rounded text-xs">
                            ${ editingSetting.setting_type }
                        </span>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Current Value</label>
                        <div class="px-3 py-2 bg-[var(--bg-tertiary)] text-[var(--text-muted)] rounded-md">
                            <span v-if="editingSetting.key === 'transcript_length_limit' && editingSetting.value === '-1'">
                                No Limit
                            </span>
                            <span v-else-if="editingSetting.key === 'transcript_length_limit'">
                                ${ Number(editingSetting.value).toLocaleString() } characters
                            </span>
                            <span v-else-if="editingSetting.key === 'max_file_size_mb'">
                                ${ Number(editingSetting.value).toLocaleString() } MB
                            </span>
                            <span v-else-if="editingSetting.key === 'asr_timeout_seconds'">
                                ${ Number(editingSetting.value).toLocaleString() } seconds (${ Math.round(Number(editingSetting.value) / 60) } minutes)
                            </span>
                            <span v-else>${ editingSetting.value || 'Not set' }</span>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2">New Value</label>
                        
                        <!-- Boolean type -->
                        <div v-if="editingSetting.setting_type === 'boolean'" class="flex items-center space-x-4">
                            <label class="flex items-center cursor-pointer">
                                <input v-model="settingNewValue" type="radio" value="true" class="mr-2 text-[var(--text-accent)] focus:ring-[var(--border-focus)]">
                                <span class="text-[var(--text-primary)]">Enabled</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input v-model="settingNewValue" type="radio" value="false" class="mr-2 text-[var(--text-accent)] focus:ring-[var(--border-focus)]">
                                <span class="text-[var(--text-primary)]">Disabled</span>
                            </label>
                        </div>
                        
                        <!-- Integer/Float type with special handling for specific keys -->
                        <div v-else-if="editingSetting.setting_type === 'integer' || editingSetting.setting_type === 'float'" class="space-y-2">
                            <!-- Special input for transcript_length_limit -->
                            <div v-if="editingSetting.key === 'transcript_length_limit'" class="space-y-2">
                                <div class="flex items-center space-x-2">
                                    <input v-model="settingUseNoLimit" type="checkbox" id="noLimit" class="rounded border-[var(--border-secondary)] text-[var(--text-accent)] focus:ring-[var(--border-focus)]">
                                    <label for="noLimit" class="text-sm text-[var(--text-secondary)]">No limit (use entire transcript)</label>
                                </div>
                                <input v-if="!settingUseNoLimit" v-model.number="settingNewValue" type="number" min="1000" step="1000" 
                                       class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]"
                                       placeholder="Enter character limit (e.g., 30000)">
                                <small v-if="!settingUseNoLimit" class="text-[var(--text-muted)]">Recommended: 30000-50000 characters for most LLMs</small>
                            </div>
                            
                            <!-- Special input for max_file_size_mb -->
                            <div v-else-if="editingSetting.key === 'max_file_size_mb'" class="space-y-2">
                                <input v-model.number="settingNewValue" type="number" min="1" max="10000" step="50"
                                       class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]"
                                       placeholder="Enter size in MB">
                                <small class="text-[var(--text-muted)]">Maximum file size in megabytes (1-10000 MB)</small>
                            </div>
                            
                            <!-- Special input for asr_timeout_seconds -->
                            <div v-else-if="editingSetting.key === 'asr_timeout_seconds'" class="space-y-2">
                                <div class="flex space-x-2">
                                    <div class="flex-1">
                                        <input v-model.number="settingTimeoutMinutes" type="number" min="1" max="600" step="1"
                                               class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]"
                                               placeholder="Minutes">
                                        <small class="text-[var(--text-muted)]">Minutes</small>
                                    </div>
                                    <div class="flex-1">
                                        <input v-model.number="settingTimeoutSeconds" type="number" min="0" max="59" step="1"
                                               class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]"
                                               placeholder="Seconds">
                                        <small class="text-[var(--text-muted)]">Seconds</small>
                                    </div>
                                </div>
                                <div class="text-sm text-[var(--text-muted)]">
                                    Total: <span class="font-medium text-[var(--text-primary)]">${ (settingTimeoutMinutes * 60 + settingTimeoutSeconds).toLocaleString() } seconds</span>
                                </div>
                                <small class="text-[var(--text-muted)]">Recommended: 30-120 minutes for long audio files</small>
                            </div>
                            
                            <!-- Default number input -->
                            <input v-else v-model.number="settingNewValue" :type="editingSetting.setting_type === 'integer' ? 'number' : 'text'" 
                                   class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]"
                                   :placeholder="`Enter ${editingSetting.setting_type} value`">
                        </div>
                        
                        <!-- String type -->
                        <textarea v-else v-model="settingNewValue" rows="3"
                                  class="w-full px-3 py-2 border border-[var(--border-secondary)] rounded-md focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] bg-[var(--bg-input)] text-[var(--text-primary)]"
                                  :placeholder="'Enter value'"></textarea>
                    </div>
                    
                    <div v-if="settingError" class="p-3 bg-[var(--bg-danger-light)] text-[var(--text-danger-strong)] rounded-md text-sm">
                        ${ settingError }
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button @click="showEditSettingModal = false" 
                            class="px-4 py-2 border border-[var(--border-secondary)] text-[var(--text-secondary)] rounded-md hover:bg-[var(--bg-tertiary)]">
                        Cancel
                    </button>
                    <button @click="saveSettingValue" 
                            class="px-4 py-2 bg-[var(--bg-button)] text-[var(--text-button)] rounded-md hover:bg-[var(--bg-button-hover)]">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue
        
        createApp({
            setup() {
                // State
                const activeTab = ref('users');
                const users = ref([]);
                const stats = ref({
                    total_users: 0,
                    total_recordings: 0,
                    total_storage: 0,
                    total_queries: 0,
                    completed_recordings: 0,
                    processing_recordings: 0,
                    pending_recordings: 0,
                    failed_recordings: 0,
                    top_users: []
                });
                const settings = ref([]);
                const isLoadingUsers = ref(true);
                const isLoadingSettings = ref(false);
                const userSearchQuery = ref('');
                const isDarkMode = ref(false);
                const isUserMenuOpen = ref(false);
                
                // Modal state
                const showAddUserModal = ref(false);
                const showEditUserModal = ref(false);
                const showDeleteUserModal = ref(false);
                const newUser = ref({
                    username: '',
                    email: '',
                    password: '',
                    confirmPassword: '',
                    isAdmin: false
                });
                const editingUser = ref(null);
                const userToDelete = ref(null);
                
                // Inquire Mode state
                const inquireModeEnabled = ref({{ 'true' if inquire_mode_enabled else 'false' }});
                const inquireStatus = ref({
                    total_completed_recordings: 0,
                    recordings_with_transcriptions: 0,
                    processed_for_inquire: 0,
                    need_processing: 0,
                    total_chunks: 0,
                    embeddings_available: false
                });
                const isProcessingRecordings = ref(false);
                const processingResult = ref(null);
                
                // Default Prompts state
                const defaultSummaryPrompt = ref('');
                const isSavingPrompt = ref(false);
                const promptSaveMessage = ref('');
                const promptSaveError = ref(false);
                const showFullPromptStructure = ref(false);
                const originalDefaultPrompt = `Generate a comprehensive summary that includes the following sections:
- **Key Issues Discussed**: A bulleted list of the main topics
- **Key Decisions Made**: A bulleted list of any decisions reached
- **Action Items**: A bulleted list of tasks assigned, including who is responsible if mentioned`;
                
                // Computed properties
                const filteredUsers = computed(() => {
                    if (!userSearchQuery.value) return users.value;
                    
                    const query = userSearchQuery.value.toLowerCase();
                    return users.value.filter(user => 
                        user.username.toLowerCase().includes(query) || 
                        user.email.toLowerCase().includes(query)
                    );
                });
                
                // Methods
                const loadUsers = async () => {
                    isLoadingUsers.value = true;
                    try {
                        const response = await fetch('/admin/users');
                        if (!response.ok) throw new Error('Failed to load users');
                        
                        const data = await response.json();
                        users.value = data;
                    } catch (error) {
                        console.error('Error loading users:', error);
                        // Show error notification
                    } finally {
                        isLoadingUsers.value = false;
                    }
                };
                
                const loadStats = async () => {
                    try {
                        const response = await fetch('/admin/stats');
                        if (!response.ok) throw new Error('Failed to load statistics');
                        
                        const data = await response.json();
                        stats.value = data;
                    } catch (error) {
                        console.error('Error loading statistics:', error);
                        // Show error notification
                    }
                };
                
                const loadSettings = async () => {
                    isLoadingSettings.value = true;
                    try {
                        const response = await fetch('/admin/settings');
                        if (!response.ok) throw new Error('Failed to load settings');
                        
                        const data = await response.json();
                        settings.value = data;
                    } catch (error) {
                        console.error('Error loading settings:', error);
                        // Show error notification
                    } finally {
                        isLoadingSettings.value = false;
                    }
                };
                
                const showEditSettingModal = ref(false);
                const editingSetting = ref(null);
                const settingNewValue = ref('');
                const settingUseNoLimit = ref(false);
                const settingTimeoutMinutes = ref(30);
                const settingTimeoutSeconds = ref(0);
                const settingError = ref('');
                
                const editSetting = (setting) => {
                    editingSetting.value = { ...setting };
                    settingError.value = '';
                    
                    // Initialize form values based on setting type and key
                    if (setting.key === 'transcript_length_limit') {
                        if (setting.value === '-1') {
                            settingUseNoLimit.value = true;
                            settingNewValue.value = 30000; // Default if unchecked
                        } else {
                            settingUseNoLimit.value = false;
                            settingNewValue.value = parseInt(setting.value) || 30000;
                        }
                    } else if (setting.key === 'asr_timeout_seconds') {
                        const totalSeconds = parseInt(setting.value) || 1800;
                        settingTimeoutMinutes.value = Math.floor(totalSeconds / 60);
                        settingTimeoutSeconds.value = totalSeconds % 60;
                    } else if (setting.setting_type === 'boolean') {
                        settingNewValue.value = setting.value || 'false';
                    } else {
                        settingNewValue.value = setting.value || '';
                    }
                    
                    showEditSettingModal.value = true;
                };
                
                const saveSettingValue = async () => {
                    settingError.value = '';
                    
                    let finalValue;
                    
                    // Validate and prepare the value based on setting type
                    if (editingSetting.value.key === 'transcript_length_limit') {
                        if (settingUseNoLimit.value) {
                            finalValue = '-1';
                        } else {
                            const num = parseInt(settingNewValue.value);
                            if (isNaN(num) || num < 1000) {
                                settingError.value = 'Please enter a valid number of at least 1000 characters';
                                return;
                            }
                            finalValue = num.toString();
                        }
                    } else if (editingSetting.value.key === 'max_file_size_mb') {
                        const num = parseInt(settingNewValue.value);
                        if (isNaN(num) || num < 1 || num > 10000) {
                            settingError.value = 'Please enter a valid size between 1 and 10000 MB';
                            return;
                        }
                        finalValue = num.toString();
                    } else if (editingSetting.value.key === 'asr_timeout_seconds') {
                        const totalSeconds = (settingTimeoutMinutes.value * 60) + settingTimeoutSeconds.value;
                        if (totalSeconds < 60) {
                            settingError.value = 'Timeout must be at least 60 seconds';
                            return;
                        }
                        if (totalSeconds > 36000) {
                            settingError.value = 'Timeout cannot exceed 10 hours (36000 seconds)';
                            return;
                        }
                        finalValue = totalSeconds.toString();
                    } else if (editingSetting.value.setting_type === 'integer') {
                        const num = parseInt(settingNewValue.value);
                        if (isNaN(num)) {
                            settingError.value = 'Please enter a valid integer';
                            return;
                        }
                        finalValue = num.toString();
                    } else if (editingSetting.value.setting_type === 'float') {
                        const num = parseFloat(settingNewValue.value);
                        if (isNaN(num)) {
                            settingError.value = 'Please enter a valid number';
                            return;
                        }
                        finalValue = num.toString();
                    } else {
                        finalValue = settingNewValue.value;
                    }
                    
                    // Save the setting
                    await updateSetting(
                        editingSetting.value.key,
                        finalValue,
                        editingSetting.value.description,
                        editingSetting.value.setting_type
                    );
                    
                    showEditSettingModal.value = false;
                };
                
                const updateSetting = async (key, value, description, settingType) => {
                    try {
                        // Get CSRF token
                        const csrfToken = document.querySelector('meta[name=csrf-token]')?.getAttribute('content');
                        
                        const headers = {
                            'Content-Type': 'application/json'
                        };
                        
                        if (csrfToken) {
                            headers['X-CSRFToken'] = csrfToken;
                        }
                        
                        const response = await fetch('/admin/settings', {
                            method: 'POST',
                            headers: headers,
                            body: JSON.stringify({
                                key: key,
                                value: value,
                                description: description,
                                setting_type: settingType
                            })
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to update setting');
                        }
                        
                        // Reload settings
                        await loadSettings();
                        
                    } catch (error) {
                        console.error('Error updating setting:', error);
                        alert(error.message);
                    }
                };
                
                const formatDate = (dateString) => {
                    if (!dateString) return 'Never';
                    const date = new Date(dateString);
                    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                };
                
                const addUser = async () => {
                    if (newUser.value.password !== newUser.value.confirmPassword) {
                        alert('Passwords do not match');
                        return;
                    }
                    
                    try {
                        // Get CSRF token
                        const csrfToken = document.querySelector('meta[name=csrf-token]')?.getAttribute('content');
                        
                        const headers = {
                            'Content-Type': 'application/json'
                        };
                        
                        if (csrfToken) {
                            headers['X-CSRFToken'] = csrfToken;
                        }
                        
                        const response = await fetch('/admin/users', {
                            method: 'POST',
                            headers: headers,
                            body: JSON.stringify({
                                username: newUser.value.username,
                                email: newUser.value.email,
                                password: newUser.value.password,
                                is_admin: newUser.value.isAdmin
                            })
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to add user');
                        }
                        
                        // Reset form and close modal
                        newUser.value = {
                            username: '',
                            email: '',
                            password: '',
                            confirmPassword: '',
                            isAdmin: false
                        };
                        showAddUserModal.value = false;
                        
                        // Reload users
                        await loadUsers();
                        await loadStats();
                        
                    } catch (error) {
                        console.error('Error adding user:', error);
                        alert(error.message);
                    }
                };
                
                const editUser = (user) => {
                    editingUser.value = { ...user, password: '' };
                    showEditUserModal.value = true;
                };
                
                const updateUser = async () => {
                    try {
                        const payload = {
                            username: editingUser.value.username,
                            email: editingUser.value.email,
                            is_admin: editingUser.value.is_admin
                        };
                        
                        // Only include password if it was changed
                        if (editingUser.value.password) {
                            payload.password = editingUser.value.password;
                        }
                        
                        // Get CSRF token
                        const csrfToken = document.querySelector('meta[name=csrf-token]')?.getAttribute('content');
                        
                        const headers = {
                            'Content-Type': 'application/json'
                        };
                        
                        if (csrfToken) {
                            headers['X-CSRFToken'] = csrfToken;
                        }
                        
                        const response = await fetch(`/admin/users/${editingUser.value.id}`, {
                            method: 'PUT',
                            headers: headers,
                            body: JSON.stringify(payload)
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to update user');
                        }
                        
                        // Close modal and reload users
                        showEditUserModal.value = false;
                        await loadUsers();
                        
                    } catch (error) {
                        console.error('Error updating user:', error);
                        alert(error.message);
                    }
                };
                
                const confirmDeleteUser = (user) => {
                    userToDelete.value = user;
                    showDeleteUserModal.value = true;
                };
                
                const deleteUser = async () => {
                    try {
                        // Get CSRF token
                        const csrfToken = document.querySelector('meta[name=csrf-token]')?.getAttribute('content');
                        
                        const headers = {};
                        
                        if (csrfToken) {
                            headers['X-CSRFToken'] = csrfToken;
                        }
                        
                        const response = await fetch(`/admin/users/${userToDelete.value.id}`, {
                            method: 'DELETE',
                            headers: headers
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to delete user');
                        }
                        
                        // Close modal and reload users
                        showDeleteUserModal.value = false;
                        await loadUsers();
                        await loadStats();
                        
                    } catch (error) {
                        console.error('Error deleting user:', error);
                        alert(error.message);
                    }
                };
                
                const toggleAdminStatus = async (user) => {
                    try {
                        // Get CSRF token
                        const csrfToken = document.querySelector('meta[name=csrf-token]')?.getAttribute('content');
                        
                        const headers = {};
                        
                        if (csrfToken) {
                            headers['X-CSRFToken'] = csrfToken;
                        }
                        
                        const response = await fetch(`/admin/users/${user.id}/toggle-admin`, {
                            method: 'POST',
                            headers: headers
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to toggle admin status');
                        }
                        
                        // Reload users
                        await loadUsers();
                        
                    } catch (error) {
                        console.error('Error toggling admin status:', error);
                        alert(error.message);
                    }
                };
                
                const formatFileSize = (bytes) => {
                    if (!bytes || bytes === 0) return '0 Bytes';
                    
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                };
                
                const toggleDarkMode = () => {
                    isDarkMode.value = !isDarkMode.value;
                    if (isDarkMode.value) {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('darkMode', 'true');
                    } else {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('darkMode', 'false');
                    }
                };
                
                // Initialize dark mode
                const initializeDarkMode = () => {
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    const savedMode = localStorage.getItem('darkMode');
                    
                    if (savedMode === 'true' || (savedMode === null && prefersDark)) {
                        isDarkMode.value = true;
                        document.documentElement.classList.add('dark');
                    } else {
                        isDarkMode.value = false;
                        document.documentElement.classList.remove('dark');
                    }
                };
                
                // Inquire Mode methods
                // Default Prompts methods
                const loadDefaultPrompt = async () => {
                    try {
                        // Load the admin_default_summary_prompt from settings
                        const response = await fetch('/admin/settings');
                        if (!response.ok) throw new Error('Failed to load settings');
                        
                        const settings = await response.json();
                        const promptSetting = settings.find(s => s.key === 'admin_default_summary_prompt');
                        if (promptSetting) {
                            defaultSummaryPrompt.value = promptSetting.value || '';
                        }
                    } catch (error) {
                        console.error('Error loading default prompt:', error);
                        promptSaveMessage.value = 'Failed to load default prompt';
                        promptSaveError.value = true;
                    }
                };
                
                const saveDefaultPrompt = async () => {
                    isSavingPrompt.value = true;
                    promptSaveMessage.value = '';
                    promptSaveError.value = false;
                    
                    try {
                        const response = await fetch('/admin/settings', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').content
                            },
                            body: JSON.stringify({
                                key: 'admin_default_summary_prompt',
                                value: defaultSummaryPrompt.value,
                                description: 'Default summarization prompt used when users have not set their own prompt. This serves as the base prompt for all users.',
                                setting_type: 'string'
                            })
                        });
                        
                        if (!response.ok) throw new Error('Failed to save prompt');
                        
                        promptSaveMessage.value = 'Default prompt saved successfully!';
                        promptSaveError.value = false;
                        
                        // Clear message after 3 seconds
                        setTimeout(() => {
                            promptSaveMessage.value = '';
                        }, 3000);
                    } catch (error) {
                        console.error('Error saving default prompt:', error);
                        promptSaveMessage.value = 'Failed to save default prompt. Please try again.';
                        promptSaveError.value = true;
                    } finally {
                        isSavingPrompt.value = false;
                    }
                };
                
                const resetDefaultPrompt = () => {
                    defaultSummaryPrompt.value = originalDefaultPrompt;
                    promptSaveMessage.value = 'Prompt reset to system default. Click "Save Changes" to apply.';
                    promptSaveError.value = false;
                };
                
                const loadInquireStatus = async () => {
                    try {
                        const response = await fetch('/admin/inquire/status');
                        if (!response.ok) throw new Error('Failed to load inquire status');
                        
                        const data = await response.json();
                        inquireStatus.value = data;
                    } catch (error) {
                        console.error('Error loading inquire status:', error);
                    }
                };
                
                const processAllRecordings = async () => {
                    if (isProcessingRecordings.value) return;
                    
                    isProcessingRecordings.value = true;
                    processingResult.value = null;
                    
                    try {
                        const response = await fetch('/admin/inquire/process-recordings', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                            },
                            body: JSON.stringify({})
                        });
                        
                        if (!response.ok) throw new Error('Failed to process recordings');
                        
                        const data = await response.json();
                        processingResult.value = data;
                        
                        // Reload status after processing
                        await loadInquireStatus();
                    } catch (error) {
                        console.error('Error processing recordings:', error);
                        processingResult.value = {
                            success: false,
                            message: 'Failed to process recordings. Please try again.'
                        };
                    } finally {
                        isProcessingRecordings.value = false;
                    }
                };
                
                const processBatchRecordings = async (batchSize) => {
                    if (isProcessingRecordings.value) return;
                    
                    isProcessingRecordings.value = true;
                    processingResult.value = null;
                    
                    try {
                        const response = await fetch('/admin/inquire/process-recordings', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                            },
                            body: JSON.stringify({ max_recordings: batchSize })
                        });
                        
                        if (!response.ok) throw new Error('Failed to process recordings');
                        
                        const data = await response.json();
                        processingResult.value = data;
                        
                        // Reload status after processing
                        await loadInquireStatus();
                    } catch (error) {
                        console.error('Error processing recordings:', error);
                        processingResult.value = {
                            success: false,
                            message: 'Failed to process recordings. Please try again.'
                        };
                    } finally {
                        isProcessingRecordings.value = false;
                    }
                };
                
                const getProcessingProgress = () => {
                    const total = (inquireStatus.value.processed_for_inquire || 0) + (inquireStatus.value.need_processing || 0);
                    if (total === 0) return 100;
                    return Math.round((inquireStatus.value.processed_for_inquire / total) * 100);
                };
                
                // Lifecycle hooks
                onMounted(() => {
                    loadUsers();
                    loadStats();
                    initializeDarkMode();
                    loadDefaultPrompt();
                    if (inquireModeEnabled.value) {
                        loadInquireStatus();
                    }
                });
                
                // Watch for tab changes to reload data
                watch(activeTab, (newTab) => {
                    if (newTab === 'users') {
                        loadUsers();
                    } else if (newTab === 'stats') {
                        loadStats();
                    } else if (newTab === 'settings') {
                        loadSettings();
                    } else if (newTab === 'prompts') {
                        loadDefaultPrompt();
                    } else if (newTab === 'vectorstore' && inquireModeEnabled.value) {
                        loadInquireStatus();
                    }
                });
                
                return {
                    // State
                    activeTab,
                    users,
                    stats,
                    settings,
                    isLoadingUsers,
                    isLoadingSettings,
                    userSearchQuery,
                    isDarkMode,
                    isUserMenuOpen,
                    
                    // Modal state
                    showAddUserModal,
                    showEditUserModal,
                    showDeleteUserModal,
                    newUser,
                    editingUser,
                    userToDelete,
                    
                    // Settings modal state
                    showEditSettingModal,
                    editingSetting,
                    settingNewValue,
                    settingUseNoLimit,
                    settingTimeoutMinutes,
                    settingTimeoutSeconds,
                    settingError,
                    
                    // Inquire Mode state
                    inquireModeEnabled,
                    inquireStatus,
                    isProcessingRecordings,
                    processingResult,
                    
                    // Default Prompts state
                    defaultSummaryPrompt,
                    isSavingPrompt,
                    promptSaveMessage,
                    promptSaveError,
                    showFullPromptStructure,
                    originalDefaultPrompt,
                    
                    // Computed
                    filteredUsers,
                    getProcessingProgress,
                    
                    // Methods
                    loadUsers,
                    loadStats,
                    loadSettings,
                    editSetting,
                    saveSettingValue,
                    updateSetting,
                    formatDate,
                    addUser,
                    editUser,
                    updateUser,
                    confirmDeleteUser,
                    deleteUser,
                    toggleAdminStatus,
                    formatFileSize,
                    toggleDarkMode,
                    
                    // Inquire Mode methods
                    loadInquireStatus,
                    processAllRecordings,
                    processBatchRecordings,
                    
                    // Default Prompts methods
                    loadDefaultPrompt,
                    saveDefaultPrompt,
                    resetDefaultPrompt
                };
            },
            delimiters: ['${', '}'] // Use different delimiters to avoid conflict with Flask's Jinja2
        }).mount('#app');
    </script>
</body>
</html>
